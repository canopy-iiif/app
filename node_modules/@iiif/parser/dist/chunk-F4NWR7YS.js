import{h as V}from"./chunk-RCT3CZAV.js";import{a as z,d as H}from"./chunk-OXZD4PMB.js";function L(e,n){let i=n||"unknown";if(!e)return;if(typeof e=="string")return{id:e,type:i};if(z(e))return L(e.source,n);let r=i&&i!=="unknown"?i:e.type||e["@type"],t=e.id||e["@id"];if(r&&r.indexOf(":")!==-1&&(r=r.split(":").pop()),t&&r)return{id:t,type:r}}var w={},d="iiif-parser:hasPart",g="iiif-parser:partOf",T="iiif-parser:isExternal",m="__$UNSET$__",j="__$UNWRAP$__",o=[];Object.freeze(o);Object.freeze(w);function oe(e){if(e===w||Object.keys(e).length===0)return!0;for(let n in e)return!1;return!0}function ae(e,n){if(n&&n["@explicit"]){let i={},r=Object.keys(n);for(let t of r)t===g||t==="@explicit"||(oe(n[t])?i[t]=e[t]:i[t]=n[t]);return i}return e}function F(e,n,i){let r=L(n);if(!r)return[void 0,void 0];let t=e.requests[r.id],a=r.type||e.mapping[r.id];if(!a||t&&t.resourceUri&&(!e.entities[a]||!e.entities[a][t.resourceUri]))return[void 0,void 0];let s=e.entities[a][t?t.resourceUri:r.id];if(r.type&&!s)return F(e,{id:r.id},i);if(s&&s[d]){let c=s[d].find(l=>i?l[g]===i.id:l[g]===s.id);return[ae(s,c),s]}return[s,s]}var we={id:"https://iiif-parser/annotation",type:"Annotation",behavior:o,label:null,thumbnail:o,summary:null,requiredStatement:null,metadata:o,seeAlso:o,homepage:o,rendering:o,service:o,accessibility:o,audience:o,body:o,bodyValue:null,canonical:null,created:null,creator:o,generated:null,generator:o,modified:null,motivation:o,rights:null,stylesheet:null,target:o,timeMode:void 0,via:o,partOf:o},K={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:o,label:null,thumbnail:o,summary:null,requiredStatement:null,metadata:o,rights:null,provider:o,items:o,seeAlso:o,homepage:o,rendering:o,service:o},G={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:o,thumbnail:o,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,partOf:o,rendering:o,service:o,duration:0,height:0,width:0},X={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:o,thumbnail:o,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,partOf:o,rendering:o,service:o,services:o},Y={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:o,behavior:o,homepage:o,items:o,label:null,metadata:o,navDate:null,provider:o,partOf:o,accompanyingCanvas:null,placeholderCanvas:null,rendering:o,requiredStatement:null,rights:null,seeAlso:o,service:o,services:o,start:null,structures:o,summary:null,thumbnail:o,viewingDirection:"left-to-right"},J={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:o,thumbnail:o,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,partOf:o,rendering:o,service:o,start:null,supplementary:null,viewingDirection:"left-to-right"},B={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:o,seeAlso:o,homepage:o},Q={id:"https://iiif-parser/empty-service",type:"UnknownService"};function k(e,n={}){if(Array.isArray(e))return k(e[0]);if(typeof e=="string"){let[i,r]=e.split("#");return r?{type:"SpecificResource",source:{id:i,type:n.typeHint||"Unknown"},selector:{type:"FragmentSelector",value:r}}:{type:"SpecificResource",source:{id:i,type:n.typeMap&&n.typeMap[i]||n.typeHint||"Unknown"}}}if(e.type==="Choice"||e.type==="List"||e.type==="Composite"||e.type==="Independents")return k(e.items[0]);if(!e.type&&"source"in e&&(e.type="SpecificResource"),e.type==="SpecificResource")return e.source.type==="Canvas"&&e.source.partOf&&typeof e.source.partOf=="string"&&(e.source.partOf=[{id:e.source.partOf,type:"Manifest"}]),e.selector?{type:"SpecificResource",source:e.source,selector:e.selector}:{type:"SpecificResource",source:e.source};if(e.id){e.type==="Canvas"&&e.partOf&&typeof e.partOf=="string"&&(e.partOf=[{id:e.partOf,type:"Manifest"}]);let[i,r]=e.id.split("#");return r?{type:"SpecificResource",source:{...e,id:i},selector:{type:"FragmentSelector",value:r}}:{type:"SpecificResource",source:{...e,id:i}}}return{type:"SpecificResource",source:e}}var Fe={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}};function se(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function Z(e,n){if(typeof e=="string")return{id:e,type:n};if(!e.id)throw new Error(`Invalid resource does not have an ID (${JSON.stringify(e)}, ${n})`);return e}function le(e,n){return(i,r)=>{let t=e[i]?e[i]:{};return(a,s)=>{let c=Z(a,r||i);return c&&c.id&&i?(t[c.id]=t[c.id]?W(t[c.id],c,{parent:s.parent,isTopLevel:n.id===c.id}):W({id:c.id,type:c.type},c,{parent:s.parent,isTopLevel:n.id===c.id}),{id:c.id,type:i==="ContentResource"?i:c.type}):c}}}function $(e,n,i){if(!n)return e;if(Array.isArray(e)){if(!Array.isArray(n))throw new Error("Cannot merge array with non-array");let r=[...e];for(let t of n)if(t["@id"]&&!t.id&&(t.id=t["@id"]),t["@type"]&&!t.type&&(t.type=t["@type"]),t!=null)if(Array.isArray(t))r.push(t);else if(typeof t=="object"&&t.id&&t.type){let a=r.findIndex(s=>s.id===t.id&&s.type===t.type);a>=0&&(r[a]=$(r[a],t))}else e.indexOf(t)===-1&&r.push(t);return r}else if(typeof e=="object"){if(Array.isArray(n)||typeof n!="object")throw new Error("Cannot merge object with non-object");let r={...e},t=[],a=[],s=Object.keys(e).filter(l=>l!==d&&l!=="id"&&l!=="type"),c={},A={};for(let[l,u]of Object.entries(n)){if(l===d||l==="id"||l==="type")continue;let y=r[l];y===u?a.push(l):y===o||!y?(t.push(l),r[l]=u):(y&&u&&(c[l]=y,A[l]=u),r[l]=$(y,u),r[l]===c[l]&&(a.push(l),delete c[l]))}if(i&&(i.parent&&i.parent.id||i.isTopLevel)){let l=[],u={};if(i.parent?u[g]=i.parent.id:i.isTopLevel&&(u[g]=e.id),r[d]&&r[d].length){let y=!(r[d]||[]).find(v=>v["@explicit"]),C=t.length>0||a.length!==s.length;if(y&&C)for(let v of r[d]){let p={...v},_=Object.keys(c);if(p){p["@explicit"]=!0;for(let M of s)M!==d&&(p[M]=w);for(let M of _)p[M]=c[M]}l.push(p)}else l.push(...r[d]);if(C){let v=Object.keys(A);u["@explicit"]=!0;for(let p of t)u[p]=w;for(let p of a)u[p]=w;for(let p of v)u[p]=A[p]}}u.id=r.id,u.type=r.type,l.push(u),r[d]=l}return r}else if(e)return e;return n}function W(e,n,i){if(typeof e=="string")return e;if(n.id!==e.id||n.type!==e.type){if(n.type==="ImageService3")return n;if(e.type==="ImageService3")return e;throw new Error(`Can only merge entities with identical identifiers and type! ${n.type}(${n.id}) => ${e.type}(${e.id})`)}return $({...e},n,i)}function ce(e){return(n,i)=>r=>{let{id:t,type:a}=Z(r,i||n);if(typeof t>"u")throw new Error("Found invalid entity without an ID.");return n==="ContentResource"||n==="Service"?e[t]=n:e[t]=a,r}}function fe(e){let n=Object.assign({},e);if(n["@id"]&&(n.id=n["@id"]),n["@type"]&&(n.type=n["@type"]),n.service){let i=[];n.service=Array.isArray(n.service)?n.service:[n.service];for(let r of n.service)i.push({id:r["@id"]||r.id,type:r["@type"]||r.type});n.service=i}return Object.assign({},Q,n)}function ue(e){return n=>{e.Service=e.Service?e.Service:{};let i=n.id||n["@id"],r=fe(n);return r&&r.id&&(e.Service[r.id]?e.Service[i]=W(e.Service[i],r):e.Service[i]=r),n}}function de(e){let n=JSON.stringify(e),i=5381,r=n.length;for(;r;)i=i*33^n.charCodeAt(--r);let a=(i>>>0).toString(16);return a.length%2?"0"+a:a}function U(e){return n=>typeof n=="string"?{id:n,type:e}:n.id?n.type?n:{type:e,...n}:{id:`vault://${de(n)}`,type:e,...n}}function E(e){return n=>({...e,...n})}function D(e){return Array.isArray(e)?e:[e]}function pe(e){return e.body&&(e.body=D(e.body)),e.seeAlso&&(e.seeAlso=D(e.seeAlso)),e.audience&&(e.audience=D(e.audience)),e.accessibility&&(e.accessibility=D(e.accessibility)),e.motivation&&(e.motivation=D(e.motivation)),e}function ee(e,{typeHint:n,partOfTypeHint:i}={}){if(typeof e=="string"&&(e={id:e,type:n||"unknown"}),z(e))return typeof e.source=="string"&&(e.source={id:e.source,type:n||"unknown"}),e.source.type==="Canvas"&&e.source.partOf&&typeof e.source.partOf=="string"&&(e.source.partOf=[{id:e.source.partOf,type:i||"Manifest"}]),e;let r;if((e.id||"").indexOf("#")!==-1){let[t,a]=(e.id||"").split("#");e.id=t,a&&(r={type:"FragmentSelector",value:a})}return{type:"SpecificResource",source:e,selector:r}}function ye(e){let n=Object.assign({},e);return e&&e.items&&(n.items=e.items.map(i=>typeof i=="string"||i.type==="Canvas"?ee(i):i)),n}function me(e){let n=Object.assign({},e);return n.start?(n.start=ee(n.start,{typeHint:"Canvas"}),n):e}function ve(e){let n=Object.assign({},e);return n.target?(n.target=k(n.target,{typeHint:"Canvas"}),n):e}function ge(e){return e}function q(e){return typeof e.items>"u"&&(e[T]=!0),e}function Ue(e){let n=V(e),i=se(),r={},t=le(i,n),a=ce(r),c=new H({collection:[q,E(X),a("Collection"),t("Collection")],manifest:[q,E(Y),me,a("Manifest"),t("Manifest")],canvas:[E(G),a("Canvas"),t("Canvas")],annotationPage:[q,U("AnnotationPage"),E(K),a("AnnotationPage"),t("AnnotationPage")],annotation:[U("Annotation"),pe,ve,a("Annotation"),t("Annotation")],contentResource:[U("ContentResource"),a("ContentResource"),t("ContentResource")],range:[E(J),ye,a("Range","Canvas"),t("Range","Canvas")],agent:[E(B),a("Agent"),t("Agent")],specificResource:[ge],service:[ue(i)]}).traverseUnknown(n);return{entities:i,resource:c,mapping:r}}function he(e){let n={};for(let[i,r]of e){if(i===j&&r!==m)return r;r!==m&&typeof r<"u"&&r!==null&&(n[i]=r)}return n}function We(e,n,i){if(!n.type||!n.id)throw new Error("Unknown entity");if(!i[n.type])throw new Error(`Serializer not found for ${n.type}`);function r(t,a,s=0){let c=i[t.type];if(!c)return m;if(s>20)throw new Error("Circular reference: "+t.id+" "+t.type);let[A,l]=F(e,t.type?t:t.id,a)||(t.id&&t.type?t:null);if(!A)return m;let u=c(A,e,{parent:a,isTopLevel:n.id===t.id,fullResource:l}),y=u.next();for(;!y.done;){let C=y.value,v=m;if(C)if(Array.isArray(C)){let p=[];for(let _ of C)p.push(r(_,t,s+1));v=p}else v=r(C,t,s+1);y=u.next(v)}return y.value===m?m:he(y.value)}return r(n)}function P(e,{allowSourceString:n=!0,allowString:i=!1,allowedStringType:r}={}){let t=a=>{if(n&&a&&a.source&&typeof a.source!="string"){let s=Object.keys(a.source);if(a.source.id&&a.source.type&&s.length===2)return{...a,source:a.source.id}}return a};if(e){if(e.source&&e.source.partOf)return t(e);let a=Object.keys(e);if(a.length===2&&e.type&&e.source||a.length===3&&e.type&&e.source&&a.indexOf("selector")!==-1&&!e.selector)return i&&(!r||r===e.source.type)?e.source.id:e.source.type==="ContentResource"?{type:"SpecificResource",source:e.source.id}:e.source;if(e.selector&&!Array.isArray(e.selector)&&typeof e.selector!="string"&&e.selector.type==="FragmentSelector"){let s=`${e.source.id}#${e.selector.value}`;return i?s:{id:s,type:e.source.type}}}return t(e)}function O(e){if(!e)return;let n=Object.keys(e);if(n.length!==0){if(n.length===1){let i=n[0];if(!i)return"";let r=(e[i]||[]).join("");return i==="@none"||i==="none"||i==="en"?r:{"@language":i,"@value":r}}return n.map(i=>({"@language":i,"@value":(e[i]||[]).join("")}))}}function ne(e){return Array.isArray(e)?e.map(n=>ne(n)):typeof e=="string"?e:e.type&&e.type==="Canvas"?e.id:e}function h(e,n=!1){if(e)return e.length>1&&!n?e:e[0]||void 0}function Se(e){if(e){if(typeof e=="string")return{"@id":e};if("@id"in e){let n={...e};return delete n["@type"],n}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function N(e,n){return[["@id",e.id],["@type",n],["format",e.format],["height",e.height],["width",e.width],["viewingDirection",e.viewingDirection!=="left-to-right"?e.viewingDirection:void 0],["license",e.license?e.license:void 0]]}function*x(e){let n=e.provider?yield e.provider[0]:void 0;return[["label",O(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(i=>({label:O(i.label)||"",value:O(i.value)||""})):void 0],["description",O(e.summary)],["thumbnail",h(yield e.thumbnail)],["navDate",e.navDate],["logo",n?h(n.logo):void 0],["homepage",n?n.homepage:void 0],["attribution",e.requiredStatement?O(e.requiredStatement.value):void 0]]}function*I(e){let n=e.start&&e.start.type&&e.start.type==="SpecificResource"?P(e.start):e.start;return[["seeAlso",h(yield e.seeAlso)],["service",h((e.service||[]).map(Se))],["rendering",h(yield e.rendering)],["startCanvas",n?n.id:void 0]]}function Re(e){return e.type==="SpecificResource"}function Ae(e){return e&&e.type==="FragmentSelector"}function Ce(e){if(e&&Re(e)){let n=e.id,i=e.selector?Array.isArray(e.selector)?e.selector[0]:e.selector:void 0;return Ae(i)&&(n+="#"+i.value),n}return e?.id}var Ge={Manifest:function*(e,n,{isTopLevel:i}){return[...i?[["@context","http://iiif.io/api/presentation/2/context.json"]]:[],...N(e,"sc:Manifest"),...yield*x(e),...yield*I(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",yield e.structures]]},Canvas:function*(e){let i=(yield e.items)[0];return[...N(e,"sc:Canvas"),...yield*x(e),...yield*I(e),["images",i?[i.resources]:void 0],["annotations",e.annotations&&e.annotations.length?h(yield e.annotations):void 0]]},AnnotationPage:function*(e){return[...N(e,"sc:AnnotationList"),...yield*x(e),["resources",e.items&&e.items.length?h(yield e.items):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",ne(e.target)],["resource",h(yield e.body,!0)]]},ContentResource:function*(e){switch(e.type){case"Image":return[...N(e,"dctypes:Image"),...yield*x(e),...yield*I(e)];case"Text":case"Dataset":default:return[...N(e,void 0),...yield*x(e)]}},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",O(e.label)]]},Collection:function*(e){return[...N(e,"sc:Collection"),...yield*x(e),...yield*I(e),["members",yield*e.items]]},Range:function*(e){let n=[],i=[];if(e.items)for(let r of e.items){let t=r.type==="SpecificResource"?r.source:r;if(t){let a=yield t;n.push({"@id":Ce(r),"@type":t.type,label:a?a.label:void 0,within:e.id}),t.type==="Canvas"&&i.push(t.id)}}return[...N(e,"sc:Range"),...yield*x(e),...yield*I(e),["canvases",i.length===n.length?i:void 0],["members",i.length!==n.length?n:void 0]]}};function b(e){return[["id",e.id?.startsWith("vault://")?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height||void 0],["width",e.width||void 0],["duration",e.duration||void 0],["viewingDirection",e.viewingDirection!=="left-to-right"?e.viewingDirection:void 0],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation],[d,m]]}function f(e){if(e===m||!e||e.length===0)return;let n=e.filter(i=>i!==m);if(n.length!==0)return n}function te(e){if(e&&e.type&&e.type==="ImageService2"){let{id:n,type:i,profile:r,...t}=e,a=typeof r=="string"?r:Array.isArray(r)?r.find(s=>typeof s=="string"):"";return{"@id":n,"@type":i,profile:a?a.startsWith("http")?a:`http://iiif.io/api/image/2/${a}.json`:"http://iiif.io/api/image/2/level0.json",...t}}return e}function ie(e){if(Array.isArray(e)||(e=e?[e]:[]),!(!e||e.length===0))return e.map(te)}function*S(e){return[["label",e.label],["metadata",f(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",Array.isArray(e.rights)?e.rights[0]||void 0:e.rights||void 0],["navDate",e.navDate],["language",e.language],["thumbnail",f(yield e.thumbnail)],["placeholderCanvas",yield e.placeholderCanvas],["accompanyingCanvas",yield e.accompanyingCanvas],["provider",f(yield e.provider)]]}function*R(e,n){let i=[];for(let r of e.partOf||[])r.type==="Manifest"&&n.type==="Manifest"||i.push(yield r);return[["seeAlso",f(yield e.seeAlso)],["service",f(ie(e.service))],["services",f(ie(e.services))],["rendering",f(yield e.rendering)],["supplementary",f(yield e.supplementary)],["homepage",f(yield e.homepage)],["logo",f(yield e.logo)],["partOf",f(i)],["start",e.start?P(e.start):e.start]]}var Qe={Manifest:function*(e,n,{isTopLevel:i}){if(!i)return[...b(e),...yield*S(e),["navPlace",e.navPlace]];let r="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||re(e))&&(r=["http://iiif.io/api/presentation/3/context.json","http://iiif.io/api/extension/navplace/context.json"]),[["@context",e["@context"]?e["@context"]:r],...b(e),...yield*S(e),...yield*R(e),["items",yield e.items],["structures",f(yield e.structures)],["annotations",f(yield e.annotations)],["navPlace",e.navPlace]]},Canvas:function*(e,n,{parent:i}){return i&&i.type!=="Manifest"&&i.type!=="Canvas"?[["id",e.id]]:[...b(e),...yield*S(e),...yield*R(e,i),["items",yield e.items],["annotations",f(yield e.annotations)],["navPlace",e.navPlace]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*R(e)]},AnnotationPage:function*(e){let n=Object.entries(e).map(([r,t])=>[r,Array.isArray(t)?f(t):t]).filter(([r,t])=>r!=="items"&&r!=="id"&&r!==d&&r!==g&&r!==T),i=yield e.items;return[["id",e.id?.startsWith("vault://")?void 0:e.id],...n,...yield*R(e),["items",i.length||e[T]===!1?i:m]]},Service:function*(e){return[[j,te(e)]]},Annotation:function*(e){let n=Object.entries(e).map(([r,t])=>r==="motivation"?[r,Array.isArray(t)?t[0]:t]:r==="target"?[r,P(t,{allowString:!0,allowSourceString:!0,allowedStringType:"Canvas"})]:[r,Array.isArray(t)?f(t):t]).filter(([r])=>r!=="body"&&r!==d&&r!==T),i;if(Array.isArray(e.body)){let r=[];for(let t of e.body)if(t&&z(t)){let a={...t};t.source.type!=="Canvas"?a.source=yield t.source:a.source=t.source,r.push(P(a,{allowSourceString:!0}))}else r.push(yield t);i=r}else e.body&&z(e.body)?(i={...e.body},i.source=yield e.body.source):i=yield e.body;return[...n,...yield*S(e),...yield*R(e),["body",i.length===1?i[0]:i]]},ContentResource:function*(e){return ze([...b(e),...yield*S(e),...yield*R(e),["annotations",f(yield e.annotations)],["items",f(yield e.items)]],e)},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,n,{isTopLevel:i}){if(i){let r="http://iiif.io/api/presentation/3/context.json";return(e.navPlace||re(e))&&(r=["http://iiif.io/api/extension/navplace/context.json","http://iiif.io/api/presentation/3/context.json"]),[["@context",r],...b(e),...yield*S(e),...yield*R(e),["items",f(yield e.items)],["navPlace",e.navPlace]]}return[...b(e),...yield*S(e),["navPlace",e.navPlace]]},Range:function*(e){let n=[];for(let i of e.items)i.type==="Range"?n.push(yield i):i&&i.type==="SpecificResource"?n.push(P(i)):n.push(i);return[...b(e),...yield*S(e),...yield*R(e),["items",n],["annotations",f(yield e.annotations)],["navPlace",e.navPlace]]}};function ze(e,n){let i=Object.keys(n),r=e.map(([t])=>t);for(let t of i)t===d||t===T||r.indexOf(t)===-1&&typeof n[t]<"u"&&e.push([t,n[t]]);return e}function re(e){if(!e.items||!Array.isArray(e.items))return!1;for(let n of e.items)if(n.navPlace)return!0;return!1}export{L as a,w as b,d as c,g as d,T as e,m as f,j as g,o as h,oe as i,ae as j,F as k,we as l,K as m,G as n,X as o,Y as p,J as q,B as r,Q as s,Fe as t,se as u,$ as v,W as w,ge as x,q as y,Ue as z,he as A,We as B,P as C,O as D,Ge as E,Qe as F};

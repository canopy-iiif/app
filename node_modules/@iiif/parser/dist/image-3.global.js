"use strict";var IIIFParser=(()=>{var F=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var ye=Object.prototype.hasOwnProperty;var _e=(i,e)=>{for(var t in e)F(i,t,{get:e[t],enumerable:!0})},Se=(i,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ie(e))!ye.call(i,r)&&r!==t&&F(i,r,{get:()=>e[r],enumerable:!(o=de(e,r))||o.enumerable});return i};var Fe=i=>Se(F({},"__esModule",{value:!0}),i);var je={};_e(je,{IIIF_1_IMAGE_LEVEL_0:()=>C,IIIF_1_IMAGE_LEVEL_0_PROFILE:()=>T,IIIF_1_IMAGE_LEVEL_1:()=>H,IIIF_1_IMAGE_LEVEL_1_PROFILE:()=>Q,IIIF_1_IMAGE_LEVEL_2:()=>V,IIIF_1_IMAGE_LEVEL_2_PROFILE:()=>D,IIIF_2_IMAGE_LEVEL_0:()=>U,IIIF_2_IMAGE_LEVEL_0_NO_JSON:()=>ie,IIIF_2_IMAGE_LEVEL_0_PROFILE:()=>k,IIIF_2_IMAGE_LEVEL_1:()=>J,IIIF_2_IMAGE_LEVEL_1_NO_JSON:()=>te,IIIF_2_IMAGE_LEVEL_1_PROFILE:()=>Z,IIIF_2_IMAGE_LEVEL_2:()=>K,IIIF_2_IMAGE_LEVEL_2_NO_JSON:()=>re,IIIF_2_IMAGE_LEVEL_2_PROFILE:()=>X,IIIF_3_IMAGE_LEVEL_0:()=>Y,IIIF_3_IMAGE_LEVEL_1:()=>q,IIIF_3_IMAGE_LEVEL_2:()=>ee,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0:()=>b,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1:()=>N,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2:()=>W,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0:()=>j,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1:()=>$,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2:()=>G,STANFORD_IIIF_IMAGE_COMPLIANCE_0:()=>L,STANFORD_IIIF_IMAGE_COMPLIANCE_1:()=>R,STANFORD_IIIF_IMAGE_COMPLIANCE_2:()=>w,STANFORD_IIIF_IMAGE_CONFORMANCE_0:()=>P,STANFORD_IIIF_IMAGE_CONFORMANCE_1:()=>M,STANFORD_IIIF_IMAGE_CONFORMANCE_2:()=>B,canonicalServiceUrl:()=>xe,combineProfiles:()=>c,createImageServiceRequest:()=>we,extraFeatures:()=>_,extractFixedSizeScales:()=>Pe,fixedSizesFromScales:()=>Me,getId:()=>fe,getImageServiceLevel:()=>Be,getImageServices:()=>be,getType:()=>Ne,identifyImageServer:()=>We,imageServiceProfiles:()=>y,imageServiceRequestInfo:()=>Re,imageServiceRequestToString:()=>ue,imageServiceSupportsFormat:()=>Oe,imageServiceSupportsRequest:()=>Le,isImageService:()=>m,isImageServiceLevel:()=>h,isLevel0:()=>ze,level0:()=>oe,level0Support:()=>Ee,level1:()=>ae,level1Support:()=>p,level2:()=>ne,level2Support:()=>l,levelToProfile:()=>se,onlyLevel0:()=>x,parseImageServerFromId:()=>ve,parseImageServiceRequest:()=>O,parseImageServiceUrl:()=>A,parseRegionParameter:()=>v,parseRotationParameter:()=>z,parseSizeParameter:()=>E,regionParameterToString:()=>me,rotationParameterToString:()=>le,sizeParameterToString:()=>pe,supports:()=>g,supportsCustomSizes:()=>Ae});function ve(i){let e=i.replace(/(https?:\/\/)?(www.)?/i,"");return e.indexOf("/")!==-1?e.split("/")[0]:e}function v(i){try{if(i==="full")return{full:!0};if(i==="square")return{square:!0};let e=i.startsWith("pct:"),o=i.substr(e?4:0).split(",").map(r=>parseFloat(r));return{x:o[0],y:o[1],w:o[2],h:o[3],percent:e}}catch{throw new Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+i)}}function E(i){let e={upscaled:!1,max:!1,confined:!1};if(i[0]==="^"&&(e.upscaled=!0,i=i.slice(1)),i==="max"||i==="full")return e.max=!0,e.serialiseAsFull=i==="full",e;if(i[0]==="!"&&(e.confined=!0,i=i.slice(1)),i[0]==="p")return e.percentScale=parseFloat(i.slice(4)),e;let t=i.split(",").map(o=>o.trim());return t.length&&(t[0]!==""&&(e.width=parseInt(t[0],10)),t[1]!==""&&(e.height=parseInt(t[1],10))),e}function z(i){let e={angle:0};if(i[0]==="!"&&(e.mirror=!0,i=i.substr(1)),e.angle=parseFloat(i)%360,Number.isNaN(e.angle))throw new Error(`Invalid rotation ${i}`);return e}function A(i,e=""){let t=i.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!t)throw new Error(`Invalid or unknown input ${i}`);let o=t[2],r=t[3],a=t[4];if(a[0]==="/"&&(a=a.substring(1)),e.length>0){if(e[0]==="/"&&(e=e.substring(1)),e!==a.substring(0,e.length))throw new Error(`Path does not start with prefix (path: ${a}, prefix: ${e})`);a=a.substring(e.length)}return{scheme:o,server:r,path:a,prefix:e}}function O(i,e=""){let{path:t,scheme:o,server:r,prefix:a}=A(i,e),n=t.split("/").reverse(),[f,s,u,d,...S]=n,I=S.reverse().filter(Boolean).join("/");if(n.length===1||f==="")return{type:"base",scheme:o,server:r,prefix:a,identifier:I};if(f==="info.json"){let[,...he]=n;return{type:"info",scheme:o,server:r,prefix:a,identifier:he.reverse().filter(Boolean).join("/")}}if(typeof o>"u"||typeof r>"u"||typeof t>"u"||typeof d>"u"||typeof u>"u"||typeof s>"u"||typeof f>"u")throw new Error("Invalid image service URL");let[ce="",ge=""]=f.split(".");return{type:"image",scheme:o,server:r,prefix:a,identifier:I,originalPath:t,region:v(d),size:E(u),rotation:z(s),quality:ce,format:ge}}var L="http://library.stanford.edu/iiif/image-api/compliance.html#level0",R="http://library.stanford.edu/iiif/image-api/compliance.html#level1",w="http://library.stanford.edu/iiif/image-api/compliance.html#level2",P="http://library.stanford.edu/iiif/image-api/conformance.html#level0",M="http://library.stanford.edu/iiif/image-api/conformance.html#level1",B="http://library.stanford.edu/iiif/image-api/conformance.html#level2",b="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",N="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",W="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",j="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",$="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",G="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",C="http://iiif.io/api/image/1/level0.json",T="http://iiif.io/api/image/1/profiles/level0.json",H="http://iiif.io/api/image/1/level1.json",Q="http://iiif.io/api/image/1/profiles/level1.json",V="http://iiif.io/api/image/1/level2.json",D="http://iiif.io/api/image/1/profiles/level2.json",U="http://iiif.io/api/image/2/level0.json",k="http://iiif.io/api/image/2/profiles/level0.json",J="http://iiif.io/api/image/2/level1.json",Z="http://iiif.io/api/image/2/profiles/level1.json",K="http://iiif.io/api/image/2/level2.json",X="http://iiif.io/api/image/2/profiles/level2.json",Y="level0",q="level1",ee="level2",ie="http://iiif.io/api/image/2/level0",te="http://iiif.io/api/image/2/level1",re="http://iiif.io/api/image/2/level2",l=[re,w,B,W,G,V,D,K,X,ee],p=[...l,te,R,M,N,$,H,Q,J,Z,q],y=[ie,te,re,L,R,w,P,M,B,b,N,W,j,$,G,C,T,H,Q,V,D,U,k,J,Z,K,X,Y,q,ee],Ee=y,x=[ie,L,P,b,j,C,T,U,k,Y],oe={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},ae={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},ne={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]},_=["baseUriRedirect","canonicalLinkHeader","cors","jsonldMediaType","mirroring","profileLinkHeader","regionByPct","regionByPx","regionSquare","rotationArbitrary","rotationBy90s","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh","sizeUpscaling","sizeByWhListed","sizeByDistortedWh","sizeByForcedWh"];function se(i){return l.indexOf(i)!==-1?ne:p.indexOf(i)!==-1?ae:oe}function c(i){let e=i?Array.isArray(i.profile)?i.profile:[i.profile]:[],t={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let o of e)if(typeof o=="string"&&(o=se(o)),!!o){if(o.formats)for(let r of o.formats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(o.qualities)for(let r of o.qualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(o.supports)for(let r of o.supports)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);if(o.maxHeight&&(t.maxHeight=o.maxHeight),o.maxWidth&&(t.maxWidth=o.maxWidth),o.maxArea&&(t.maxArea=o.maxArea),o.extraFormats)for(let r of o.extraFormats)t.extraFormats.indexOf(r)===-1&&t.extraFormats.push(r);if(o.extraQualities)for(let r of o.extraQualities)t.extraQualities.indexOf(r)===-1&&t.extraQualities.push(r);if(o.extraFeatures)for(let r of o.extraFeatures)t.extraFeatures.indexOf(r)===-1&&t.extraFeatures.push(r);o.maxHeight&&(t.maxHeight=o.maxHeight),o.maxWidth&&(t.maxWidth=o.maxWidth),o.maxArea&&(t.maxArea=o.maxArea)}if(i.extraFormats)for(let o of i.extraFormats)t.extraFormats.indexOf(o)===-1&&t.extraFormats.push(o);if(i.extraFeatures)for(let o of i.extraFeatures)t.extraFeatures.indexOf(o)===-1&&t.extraFeatures.push(o);if(i.extraQualities)for(let o of i.extraQualities)t.extraQualities.indexOf(o)===-1&&t.extraQualities.push(o);return t}function ze(i){let e=Array.isArray(i.profile)?i.profile:[i.profile];for(let t of e)if(typeof t=="string"&&x.indexOf(t)!==-1)return!0;return!1}function fe(i){if(i["@id"])return i["@id"];if(i.id)return i.id}function m(i){if(!i||!i.profile||!fe(i))return!1;let e=Array.isArray(i.profile)?i.profile:[i.profile];for(let t of e)if(typeof t=="string"&&y.indexOf(t)!==-1)return!0;return!1}function g(i,e){if(!m(i))return[!1,"Not a valid image service"];e.extraFeatures=e.extraFeatures?e.extraFeatures:[];let t=c(i);if(e.exactSize){let o=!1;if(i.sizes)for(let r of i.sizes)r.width&&r.width===e.exactSize.width&&(_.indexOf("sizeByW")!==-1||r.height&&r.height===e.exactSize.height)&&(o=!0),r.height&&r.height===e.exactSize.height&&(_.indexOf("sizeByH")!==-1||r.width&&r.width===e.exactSize.width)&&(o=!0);o||(e.maxWidth=Math.max(e.maxWidth||0,e.exactSize.width||0)||void 0,e.maxHeight=Math.max(e.maxHeight||0,e.exactSize.height||0)||void 0,e.maxArea=Math.max(e.maxArea||0,(e.exactSize.width&&e.exactSize.height?e.exactSize.width*e.exactSize.height:e.maxArea)||0)||void 0,!e.exactSize.height&&e.exactSize.width?e.extraFeatures.indexOf("sizeByW")===-1&&e.extraFeatures.push("sizeByW"):!e.exactSize.width&&e.exactSize.height&&e.extraFeatures.indexOf("sizeByH")===-1&&e.extraFeatures.push("sizeByH"))}if(e.maxArea&&t.maxArea&&e.maxArea>t.maxArea)return[!1,`Max area is ${t.maxArea}`];if(e.maxWidth&&t.maxWidth&&e.maxWidth>t.maxWidth)return[!1,`Max width is ${t.maxWidth}`];if(e.maxHeight&&t.maxHeight&&e.maxHeight>t.maxHeight)return[!1,`Max height is ${t.maxHeight}`];if(e.extraFeatures){let o=[];for(let r of e.extraFeatures)t.extraFeatures.indexOf(r)===-1&&o.push(r);if(o.length)return[!1,`Missing features: ${o.join(", ")}`]}if(e.extraFormats){let o=[];for(let r of e.extraFormats)t.extraFormats.indexOf(r)===-1&&o.push(r);if(o.length)return[!1,`Missing formats: ${o.join(", ")}`]}if(e.extraQualities){let o=[];for(let r of e.extraQualities)t.extraQualities.indexOf(r)===-1&&o.push(r);if(o.length)return[!1,`Missing qualities: ${o.join(", ")}`]}return[!0]}function Ae(i){if(!m(i))return!1;let e=Array.isArray(i.profile)?i.profile:[i.profile];for(let t of e)if(typeof t=="string"){if(p.indexOf(t)!==-1)return!0}else{let o=[...t.supports||[],...t.extraFeatures||[]];if(o.indexOf("regionByPx")!==-1&&(o.indexOf("sizeByW")!==-1||o.indexOf("sizeByWh")!==-1))return!0}return!1}function Oe(i,e){return g(i,{extraFormats:[e]})}function Le(i,e){if(e.type!=="image")return[!0];let t=[];e.rotation.mirror&&t.push("mirroring"),e.region.percent&&t.push("regionByPct"),e.region.square?t.push("regionSquare"):e.region.full||t.push("regionByPx"),e.rotation.angle&&(e.rotation.angle%90?t.push("rotationArbitrary"):t.push("rotationBy90s")),e.size.confined&&t.push("sizeByConfinedWh"),!e.size.width&&e.size.height&&t.push("sizeByH"),e.size.percentScale&&t.push("sizeByPct"),(i.sizes||[]).find(n=>n.width===e.size.width&&!e.size.height||n.height===e.size.height&&!e.size.width||n.height===e.size.height&&n.width===e.size.width)?t.push("sizeByWhListed"):(e.size.width&&!e.size.height&&t.push("sizeByW"),e.size.width&&e.size.height&&t.push("sizeByWh")),e.size.upscaled&&t.push("sizeUpscaling");let[r,a]=g(i,{extraFeatures:t,extraQualities:[e.quality],extraFormats:[e.format],exactSize:e.size});return r?[!0]:[!1,a]}function me({x:i=0,y:e=0,w:t,h:o,full:r,square:a,percent:n}){if(r)return"full";if(a)return"square";if(typeof t>"u"||typeof o>"u")throw new Error("RegionParameter: invalid region");let f=`${i},${e},${t},${o}`;return n?`pct:${f}`:f}function pe({max:i,percentScale:e,upscaled:t,confined:o,width:r,height:a,serialiseAsFull:n,version:f}){let s=[];return t&&s.push("^"),i?(s.push(n?"full":"max"),s.join("")):(o&&s.push("!"),e&&s.push(`pct:${e}`),r&&s.push(`${r}`),s.push(","),a&&f===3&&s.push(`${a}`),s.join(""))}function le(i){return`${i.mirror?"!":""}${(i.angle||0)%360}`}function ue(i,e){let t=i.prefix.startsWith("/")?i.prefix.substring(1):i.prefix,o=`${i.scheme}://${i.server}/${t?`${t}/`:""}${i.identifier}`;if(i.type==="base")return o;if(i.type==="info")return`${o}/info.json`;let{size:r}=i,{region:a,rotation:n,format:f,quality:s}=i;if(e){let u=e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[],d=u.indexOf("http://iiif.io/api/image/2/context.json")!==-1,S=u.indexOf("http://iiif.io/api/image/3/context.json")!==-1;if((r.width===e.width&&!r.height||r.height===e.height&&!r.width||r.width===e.width&&r.height===e.height)&&(r={...r,max:!0}),d&&(r.max&&!r.serialiseAsFull&&(r={...r,serialiseAsFull:!0}),!r.max&&r.width&&r.height&&(r={...r,height:void 0}),r={...r,version:2}),S){if(r.max&&r.serialiseAsFull&&(r={...r,serialiseAsFull:!1}),r.width&&!r.height&&e.width&&e.height){let I=e.height/e.width;r={...r,height:Math.ceil(r.width*I)}}r={...r,version:3}}}return[o,me(a),pe(r),le(n),`${s}.${f}`].filter(Boolean).join("/")}function Re(i,e){return ue({...i,type:"info"},e)}function xe(i){return i.endsWith("info.json")?i:i.endsWith("/")?`${i}info.json`:`${i}/info.json`}function we(i){let e=O(xe(i.id));if(e.type!=="info")throw new Error("Invalid service URL");let t=c(i);return{identifier:e.identifier,originalPath:"",server:e.server,prefix:e.prefix,scheme:e.scheme,type:"image",quality:t.extraQualities.indexOf("default")===-1?t.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function Pe(i,e,t){let o=t.length,r=[];for(let a=0;a<o;a++){let n=t[a];if(!n)continue;let f=n.width;r.push(i/f)}return r}function Me(i,e,t){let o=t.length,r=[];for(let a=0;a<o;a++){let n=t[a];n&&r.push({width:Math.floor(i/n),height:Math.floor(e/n)})}return r}function h(i,e){if(e&&e.profile){let t=e.profile;if(t){let o=Array.isArray(t)?t:[t];if(o.includes(`level${i}`)||o.includes(`http://iiif.io/api/image/2/level${i}.json`)||o.includes(`http://iiif.io/api/image/1/level${i}.json`)||o.includes(`http://iiif.io/api/image/1/profiles/level${i}.json`))return!0;if(i===2){for(let r of o)if(l.includes(r))return!0}if(i===1){for(let r of o)if(p.includes(r))return!0}if(i===0){for(let r of o)if(x.includes(r))return!0}}}return!1}function Be(i){return m(i)?h(0,i)?0:h(1,i)?1:h(2,i)?2:null:null}function be(i){let e=i.service?Array.isArray(i.service)?i.service:[i.service]:[],t=e.length,o=[];for(let r=0;r<t;r++)m(e[r])&&o.push(e[r]);return o}function Ne(i){if(i["@type"])return i["@type"];if(i.type)return i.type}function We(i){let e=i.replace(/(https?:\/\/)?(www.)?/i,"");return e.indexOf("/")!==-1?e.split("/")[0]:e}return Fe(je);})();
